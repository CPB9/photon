/*
 * Copyright (c) 2017 CPB9 team. See the COPYRIGHT file at the top-level directory.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */

#include "photon/groundcontrol/Crc.h"

#include <bmcl/Endian.h>
#include <bmcl/Bytes.h>

/*
 * Code generated by universal_crc by Danjel McGougan
 *
 * CRC parameters used:
 *   bits:       16
 *   poly:       0xd175
 *   init:       0xffff
 *   xor:        0x0000
 *   reverse:    true
 *   non-direct: false
 *
 * CRC of the string "123456789" is 0xf66d
 */

namespace photon {

const uint16_t crcTable[1024] = {
#ifdef BMCL_LITTLE_ENDIAN
    0x0000, 0xa784, 0x121f, 0xb59b, 0x243e, 0x83ba, 0x3621, 0x91a5,
    0x487c, 0xeff8, 0x5a63, 0xfde7, 0x6c42, 0xcbc6, 0x7e5d, 0xd9d9,
    0x90f8, 0x377c, 0x82e7, 0x2563, 0xb4c6, 0x1342, 0xa6d9, 0x015d,
    0xd884, 0x7f00, 0xca9b, 0x6d1f, 0xfcba, 0x5b3e, 0xeea5, 0x4921,
    0x7ce7, 0xdb63, 0x6ef8, 0xc97c, 0x58d9, 0xff5d, 0x4ac6, 0xed42,
    0x349b, 0x931f, 0x2684, 0x8100, 0x10a5, 0xb721, 0x02ba, 0xa53e,
    0xec1f, 0x4b9b, 0xfe00, 0x5984, 0xc821, 0x6fa5, 0xda3e, 0x7dba,
    0xa463, 0x03e7, 0xb67c, 0x11f8, 0x805d, 0x27d9, 0x9242, 0x35c6,
    0xf9ce, 0x5e4a, 0xebd1, 0x4c55, 0xddf0, 0x7a74, 0xcfef, 0x686b,
    0xb1b2, 0x1636, 0xa3ad, 0x0429, 0x958c, 0x3208, 0x8793, 0x2017,
    0x6936, 0xceb2, 0x7b29, 0xdcad, 0x4d08, 0xea8c, 0x5f17, 0xf893,
    0x214a, 0x86ce, 0x3355, 0x94d1, 0x0574, 0xa2f0, 0x176b, 0xb0ef,
    0x8529, 0x22ad, 0x9736, 0x30b2, 0xa117, 0x0693, 0xb308, 0x148c,
    0xcd55, 0x6ad1, 0xdf4a, 0x78ce, 0xe96b, 0x4eef, 0xfb74, 0x5cf0,
    0x15d1, 0xb255, 0x07ce, 0xa04a, 0x31ef, 0x966b, 0x23f0, 0x8474,
    0x5dad, 0xfa29, 0x4fb2, 0xe836, 0x7993, 0xde17, 0x6b8c, 0xcc08,
    0xae8b, 0x090f, 0xbc94, 0x1b10, 0x8ab5, 0x2d31, 0x98aa, 0x3f2e,
    0xe6f7, 0x4173, 0xf4e8, 0x536c, 0xc2c9, 0x654d, 0xd0d6, 0x7752,
    0x3e73, 0x99f7, 0x2c6c, 0x8be8, 0x1a4d, 0xbdc9, 0x0852, 0xafd6,
    0x760f, 0xd18b, 0x6410, 0xc394, 0x5231, 0xf5b5, 0x402e, 0xe7aa,
    0xd26c, 0x75e8, 0xc073, 0x67f7, 0xf652, 0x51d6, 0xe44d, 0x43c9,
    0x9a10, 0x3d94, 0x880f, 0x2f8b, 0xbe2e, 0x19aa, 0xac31, 0x0bb5,
    0x4294, 0xe510, 0x508b, 0xf70f, 0x66aa, 0xc12e, 0x74b5, 0xd331,
    0x0ae8, 0xad6c, 0x18f7, 0xbf73, 0x2ed6, 0x8952, 0x3cc9, 0x9b4d,
    0x5745, 0xf0c1, 0x455a, 0xe2de, 0x737b, 0xd4ff, 0x6164, 0xc6e0,
    0x1f39, 0xb8bd, 0x0d26, 0xaaa2, 0x3b07, 0x9c83, 0x2918, 0x8e9c,
    0xc7bd, 0x6039, 0xd5a2, 0x7226, 0xe383, 0x4407, 0xf19c, 0x5618,
    0x8fc1, 0x2845, 0x9dde, 0x3a5a, 0xabff, 0x0c7b, 0xb9e0, 0x1e64,
    0x2ba2, 0x8c26, 0x39bd, 0x9e39, 0x0f9c, 0xa818, 0x1d83, 0xba07,
    0x63de, 0xc45a, 0x71c1, 0xd645, 0x47e0, 0xe064, 0x55ff, 0xf27b,
    0xbb5a, 0x1cde, 0xa945, 0x0ec1, 0x9f64, 0x38e0, 0x8d7b, 0x2aff,
    0xf326, 0x54a2, 0xe139, 0x46bd, 0xd718, 0x709c, 0xc507, 0x6283,
    0x0000, 0x8a12, 0x4933, 0xc321, 0x9266, 0x1874, 0xdb55, 0x5147,
    0x79db, 0xf3c9, 0x30e8, 0xbafa, 0xebbd, 0x61af, 0xa28e, 0x289c,
    0xf3b6, 0x79a4, 0xba85, 0x3097, 0x61d0, 0xebc2, 0x28e3, 0xa2f1,
    0x8a6d, 0x007f, 0xc35e, 0x494c, 0x180b, 0x9219, 0x5138, 0xdb2a,
    0xba7b, 0x3069, 0xf348, 0x795a, 0x281d, 0xa20f, 0x612e, 0xeb3c,
    0xc3a0, 0x49b2, 0x8a93, 0x0081, 0x51c6, 0xdbd4, 0x18f5, 0x92e7,
    0x49cd, 0xc3df, 0x00fe, 0x8aec, 0xdbab, 0x51b9, 0x9298, 0x188a,
    0x3016, 0xba04, 0x7925, 0xf337, 0xa270, 0x2862, 0xeb43, 0x6151,
    0x29e1, 0xa3f3, 0x60d2, 0xeac0, 0xbb87, 0x3195, 0xf2b4, 0x78a6,
    0x503a, 0xda28, 0x1909, 0x931b, 0xc25c, 0x484e, 0x8b6f, 0x017d,
    0xda57, 0x5045, 0x9364, 0x1976, 0x4831, 0xc223, 0x0102, 0x8b10,
    0xa38c, 0x299e, 0xeabf, 0x60ad, 0x31ea, 0xbbf8, 0x78d9, 0xf2cb,
    0x939a, 0x1988, 0xdaa9, 0x50bb, 0x01fc, 0x8bee, 0x48cf, 0xc2dd,
    0xea41, 0x6053, 0xa372, 0x2960, 0x7827, 0xf235, 0x3114, 0xbb06,
    0x602c, 0xea3e, 0x291f, 0xa30d, 0xf24a, 0x7858, 0xbb79, 0x316b,
    0x19f7, 0x93e5, 0x50c4, 0xdad6, 0x8b91, 0x0183, 0xc2a2, 0x48b0,
    0x53c2, 0xd9d0, 0x1af1, 0x90e3, 0xc1a4, 0x4bb6, 0x8897, 0x0285,
    0x2a19, 0xa00b, 0x632a, 0xe938, 0xb87f, 0x326d, 0xf14c, 0x7b5e,
    0xa074, 0x2a66, 0xe947, 0x6355, 0x3212, 0xb800, 0x7b21, 0xf133,
    0xd9af, 0x53bd, 0x909c, 0x1a8e, 0x4bc9, 0xc1db, 0x02fa, 0x88e8,
    0xe9b9, 0x63ab, 0xa08a, 0x2a98, 0x7bdf, 0xf1cd, 0x32ec, 0xb8fe,
    0x9062, 0x1a70, 0xd951, 0x5343, 0x0204, 0x8816, 0x4b37, 0xc125,
    0x1a0f, 0x901d, 0x533c, 0xd92e, 0x8869, 0x027b, 0xc15a, 0x4b48,
    0x63d4, 0xe9c6, 0x2ae7, 0xa0f5, 0xf1b2, 0x7ba0, 0xb881, 0x3293,
    0x7a23, 0xf031, 0x3310, 0xb902, 0xe845, 0x6257, 0xa176, 0x2b64,
    0x03f8, 0x89ea, 0x4acb, 0xc0d9, 0x919e, 0x1b8c, 0xd8ad, 0x52bf,
    0x8995, 0x0387, 0xc0a6, 0x4ab4, 0x1bf3, 0x91e1, 0x52c0, 0xd8d2,
    0xf04e, 0x7a5c, 0xb97d, 0x336f, 0x6228, 0xe83a, 0x2b1b, 0xa109,
    0xc058, 0x4a4a, 0x896b, 0x0379, 0x523e, 0xd82c, 0x1b0d, 0x911f,
    0xb983, 0x3391, 0xf0b0, 0x7aa2, 0x2be5, 0xa1f7, 0x62d6, 0xe8c4,
    0x33ee, 0xb9fc, 0x7add, 0xf0cf, 0xa188, 0x2b9a, 0xe8bb, 0x62a9,
    0x4a35, 0xc027, 0x0306, 0x8914, 0xd853, 0x5241, 0x9160, 0x1b72,
    0x0000, 0x826d, 0x59cd, 0xdba0, 0xb39a, 0x31f7, 0xea57, 0x683a,
    0x3a23, 0xb84e, 0x63ee, 0xe183, 0x89b9, 0x0bd4, 0xd074, 0x5219,
    0x7446, 0xf62b, 0x2d8b, 0xafe6, 0xc7dc, 0x45b1, 0x9e11, 0x1c7c,
    0x4e65, 0xcc08, 0x17a8, 0x95c5, 0xfdff, 0x7f92, 0xa432, 0x265f,
    0xe88c, 0x6ae1, 0xb141, 0x332c, 0x5b16, 0xd97b, 0x02db, 0x80b6,
    0xd2af, 0x50c2, 0x8b62, 0x090f, 0x6135, 0xe358, 0x38f8, 0xba95,
    0x9cca, 0x1ea7, 0xc507, 0x476a, 0x2f50, 0xad3d, 0x769d, 0xf4f0,
    0xa6e9, 0x2484, 0xff24, 0x7d49, 0x1573, 0x971e, 0x4cbe, 0xced3,
    0x8c0f, 0x0e62, 0xd5c2, 0x57af, 0x3f95, 0xbdf8, 0x6658, 0xe435,
    0xb62c, 0x3441, 0xefe1, 0x6d8c, 0x05b6, 0x87db, 0x5c7b, 0xde16,
    0xf849, 0x7a24, 0xa184, 0x23e9, 0x4bd3, 0xc9be, 0x121e, 0x9073,
    0xc26a, 0x4007, 0x9ba7, 0x19ca, 0x71f0, 0xf39d, 0x283d, 0xaa50,
    0x6483, 0xe6ee, 0x3d4e, 0xbf23, 0xd719, 0x5574, 0x8ed4, 0x0cb9,
    0x5ea0, 0xdccd, 0x076d, 0x8500, 0xed3a, 0x6f57, 0xb4f7, 0x369a,
    0x10c5, 0x92a8, 0x4908, 0xcb65, 0xa35f, 0x2132, 0xfa92, 0x78ff,
    0x2ae6, 0xa88b, 0x732b, 0xf146, 0x997c, 0x1b11, 0xc0b1, 0x42dc,
    0x4509, 0xc764, 0x1cc4, 0x9ea9, 0xf693, 0x74fe, 0xaf5e, 0x2d33,
    0x7f2a, 0xfd47, 0x26e7, 0xa48a, 0xccb0, 0x4edd, 0x957d, 0x1710,
    0x314f, 0xb322, 0x6882, 0xeaef, 0x82d5, 0x00b8, 0xdb18, 0x5975,
    0x0b6c, 0x8901, 0x52a1, 0xd0cc, 0xb8f6, 0x3a9b, 0xe13b, 0x6356,
    0xad85, 0x2fe8, 0xf448, 0x7625, 0x1e1f, 0x9c72, 0x47d2, 0xc5bf,
    0x97a6, 0x15cb, 0xce6b, 0x4c06, 0x243c, 0xa651, 0x7df1, 0xff9c,
    0xd9c3, 0x5bae, 0x800e, 0x0263, 0x6a59, 0xe834, 0x3394, 0xb1f9,
    0xe3e0, 0x618d, 0xba2d, 0x3840, 0x507a, 0xd217, 0x09b7, 0x8bda,
    0xc906, 0x4b6b, 0x90cb, 0x12a6, 0x7a9c, 0xf8f1, 0x2351, 0xa13c,
    0xf325, 0x7148, 0xaae8, 0x2885, 0x40bf, 0xc2d2, 0x1972, 0x9b1f,
    0xbd40, 0x3f2d, 0xe48d, 0x66e0, 0x0eda, 0x8cb7, 0x5717, 0xd57a,
    0x8763, 0x050e, 0xdeae, 0x5cc3, 0x34f9, 0xb694, 0x6d34, 0xef59,
    0x218a, 0xa3e7, 0x7847, 0xfa2a, 0x9210, 0x107d, 0xcbdd, 0x49b0,
    0x1ba9, 0x99c4, 0x4264, 0xc009, 0xa833, 0x2a5e, 0xf1fe, 0x7393,
    0x55cc, 0xd7a1, 0x0c01, 0x8e6c, 0xe656, 0x643b, 0xbf9b, 0x3df6,
    0x6fef, 0xed82, 0x3622, 0xb44f, 0xdc75, 0x5e18, 0x85b8, 0x07d5,
    0x0000, 0x4e6d, 0x9cda, 0xd2b7, 0x64a3, 0x2ace, 0xf879, 0xb614,
    0xc946, 0x872b, 0x559c, 0x1bf1, 0xade5, 0xe388, 0x313f, 0x7f52,
    0xcf9b, 0x81f6, 0x5341, 0x1d2c, 0xab38, 0xe555, 0x37e2, 0x798f,
    0x06dd, 0x48b0, 0x9a07, 0xd46a, 0x627e, 0x2c13, 0xfea4, 0xb0c9,
    0xc221, 0x8c4c, 0x5efb, 0x1096, 0xa682, 0xe8ef, 0x3a58, 0x7435,
    0x0b67, 0x450a, 0x97bd, 0xd9d0, 0x6fc4, 0x21a9, 0xf31e, 0xbd73,
    0x0dba, 0x43d7, 0x9160, 0xdf0d, 0x6919, 0x2774, 0xf5c3, 0xbbae,
    0xc4fc, 0x8a91, 0x5826, 0x164b, 0xa05f, 0xee32, 0x3c85, 0x72e8,
    0xd955, 0x9738, 0x458f, 0x0be2, 0xbdf6, 0xf39b, 0x212c, 0x6f41,
    0x1013, 0x5e7e, 0x8cc9, 0xc2a4, 0x74b0, 0x3add, 0xe86a, 0xa607,
    0x16ce, 0x58a3, 0x8a14, 0xc479, 0x726d, 0x3c00, 0xeeb7, 0xa0da,
    0xdf88, 0x91e5, 0x4352, 0x0d3f, 0xbb2b, 0xf546, 0x27f1, 0x699c,
    0x1b74, 0x5519, 0x87ae, 0xc9c3, 0x7fd7, 0x31ba, 0xe30d, 0xad60,
    0xd232, 0x9c5f, 0x4ee8, 0x0085, 0xb691, 0xf8fc, 0x2a4b, 0x6426,
    0xd4ef, 0x9a82, 0x4835, 0x0658, 0xb04c, 0xfe21, 0x2c96, 0x62fb,
    0x1da9, 0x53c4, 0x8173, 0xcf1e, 0x790a, 0x3767, 0xe5d0, 0xabbd,
    0xefbd, 0xa1d0, 0x7367, 0x3d0a, 0x8b1e, 0xc573, 0x17c4, 0x59a9,
    0x26fb, 0x6896, 0xba21, 0xf44c, 0x4258, 0x0c35, 0xde82, 0x90ef,
    0x2026, 0x6e4b, 0xbcfc, 0xf291, 0x4485, 0x0ae8, 0xd85f, 0x9632,
    0xe960, 0xa70d, 0x75ba, 0x3bd7, 0x8dc3, 0xc3ae, 0x1119, 0x5f74,
    0x2d9c, 0x63f1, 0xb146, 0xff2b, 0x493f, 0x0752, 0xd5e5, 0x9b88,
    0xe4da, 0xaab7, 0x7800, 0x366d, 0x8079, 0xce14, 0x1ca3, 0x52ce,
    0xe207, 0xac6a, 0x7edd, 0x30b0, 0x86a4, 0xc8c9, 0x1a7e, 0x5413,
    0x2b41, 0x652c, 0xb79b, 0xf9f6, 0x4fe2, 0x018f, 0xd338, 0x9d55,
    0x36e8, 0x7885, 0xaa32, 0xe45f, 0x524b, 0x1c26, 0xce91, 0x80fc,
    0xffae, 0xb1c3, 0x6374, 0x2d19, 0x9b0d, 0xd560, 0x07d7, 0x49ba,
    0xf973, 0xb71e, 0x65a9, 0x2bc4, 0x9dd0, 0xd3bd, 0x010a, 0x4f67,
    0x3035, 0x7e58, 0xacef, 0xe282, 0x5496, 0x1afb, 0xc84c, 0x8621,
    0xf4c9, 0xbaa4, 0x6813, 0x267e, 0x906a, 0xde07, 0x0cb0, 0x42dd,
    0x3d8f, 0x73e2, 0xa155, 0xef38, 0x592c, 0x1741, 0xc5f6, 0x8b9b,
    0x3b52, 0x753f, 0xa788, 0xe9e5, 0x5ff1, 0x119c, 0xc32b, 0x8d46,
    0xf214, 0xbc79, 0x6ece, 0x20a3, 0x96b7, 0xd8da, 0x0a6d, 0x4400
#else
    0x0000, 0x84a7, 0x1f12, 0x9bb5, 0x3e24, 0xba83, 0x2136, 0xa591,
    0x7c48, 0xf8ef, 0x635a, 0xe7fd, 0x426c, 0xc6cb, 0x5d7e, 0xd9d9,
    0xf890, 0x7c37, 0xe782, 0x6325, 0xc6b4, 0x4213, 0xd9a6, 0x5d01,
    0x84d8, 0x007f, 0x9bca, 0x1f6d, 0xbafc, 0x3e5b, 0xa5ee, 0x2149,
    0xe77c, 0x63db, 0xf86e, 0x7cc9, 0xd958, 0x5dff, 0xc64a, 0x42ed,
    0x9b34, 0x1f93, 0x8426, 0x0081, 0xa510, 0x21b7, 0xba02, 0x3ea5,
    0x1fec, 0x9b4b, 0x00fe, 0x8459, 0x21c8, 0xa56f, 0x3eda, 0xba7d,
    0x63a4, 0xe703, 0x7cb6, 0xf811, 0x5d80, 0xd927, 0x4292, 0xc635,
    0xcef9, 0x4a5e, 0xd1eb, 0x554c, 0xf0dd, 0x747a, 0xefcf, 0x6b68,
    0xb2b1, 0x3616, 0xada3, 0x2904, 0x8c95, 0x0832, 0x9387, 0x1720,
    0x3669, 0xb2ce, 0x297b, 0xaddc, 0x084d, 0x8cea, 0x175f, 0x93f8,
    0x4a21, 0xce86, 0x5533, 0xd194, 0x7405, 0xf0a2, 0x6b17, 0xefb0,
    0x2985, 0xad22, 0x3697, 0xb230, 0x17a1, 0x9306, 0x08b3, 0x8c14,
    0x55cd, 0xd16a, 0x4adf, 0xce78, 0x6be9, 0xef4e, 0x74fb, 0xf05c,
    0xd115, 0x55b2, 0xce07, 0x4aa0, 0xef31, 0x6b96, 0xf023, 0x7484,
    0xad5d, 0x29fa, 0xb24f, 0x36e8, 0x9379, 0x17de, 0x8c6b, 0x08cc,
    0x8bae, 0x0f09, 0x94bc, 0x101b, 0xb58a, 0x312d, 0xaa98, 0x2e3f,
    0xf7e6, 0x7341, 0xe8f4, 0x6c53, 0xc9c2, 0x4d65, 0xd6d0, 0x5277,
    0x733e, 0xf799, 0x6c2c, 0xe88b, 0x4d1a, 0xc9bd, 0x5208, 0xd6af,
    0x0f76, 0x8bd1, 0x1064, 0x94c3, 0x3152, 0xb5f5, 0x2e40, 0xaae7,
    0x6cd2, 0xe875, 0x73c0, 0xf767, 0x52f6, 0xd651, 0x4de4, 0xc943,
    0x109a, 0x943d, 0x0f88, 0x8b2f, 0x2ebe, 0xaa19, 0x31ac, 0xb50b,
    0x9442, 0x10e5, 0x8b50, 0x0ff7, 0xaa66, 0x2ec1, 0xb574, 0x31d3,
    0xe80a, 0x6cad, 0xf718, 0x73bf, 0xd62e, 0x5289, 0xc93c, 0x4d9b,
    0x4557, 0xc1f0, 0x5a45, 0xdee2, 0x7b73, 0xffd4, 0x6461, 0xe0c6,
    0x391f, 0xbdb8, 0x260d, 0xa2aa, 0x073b, 0x839c, 0x1829, 0x9c8e,
    0xbdc7, 0x3960, 0xa2d5, 0x2672, 0x83e3, 0x0744, 0x9cf1, 0x1856,
    0xc18f, 0x4528, 0xde9d, 0x5a3a, 0xffab, 0x7b0c, 0xe0b9, 0x641e,
    0xa22b, 0x268c, 0xbd39, 0x399e, 0x9c0f, 0x18a8, 0x831d, 0x07ba,
    0xde63, 0x5ac4, 0xc171, 0x45d6, 0xe047, 0x64e0, 0xff55, 0x7bf2,
    0x5abb, 0xde1c, 0x45a9, 0xc10e, 0x649f, 0xe038, 0x7b8d, 0xff2a,
    0x26f3, 0xa254, 0x39e1, 0xbd46, 0x18d7, 0x9c70, 0x07c5, 0x8362,
    0x0000, 0x128a, 0x3349, 0x21c3, 0x6692, 0x7418, 0x55db, 0x4751,
    0xdb79, 0xc9f3, 0xe830, 0xfaba, 0xbdeb, 0xaf61, 0x8ea2, 0x9c28,
    0xb6f3, 0xa479, 0x85ba, 0x9730, 0xd061, 0xc2eb, 0xe328, 0xf1a2,
    0x6d8a, 0x7f00, 0x5ec3, 0x4c49, 0x0b18, 0x1992, 0x3851, 0x2adb,
    0x7bba, 0x6930, 0x48f3, 0x5a79, 0x1d28, 0x0fa2, 0x2e61, 0x3ceb,
    0xa0c3, 0xb249, 0x938a, 0x8100, 0xc651, 0xd4db, 0xf518, 0xe792,
    0xcd49, 0xdfc3, 0xfe00, 0xec8a, 0xabdb, 0xb951, 0x9892, 0x8a18,
    0x1630, 0x04ba, 0x2579, 0x37f3, 0x70a2, 0x6228, 0x43eb, 0x5161,
    0xe129, 0xf3a3, 0xd260, 0xc0ea, 0x87bb, 0x9531, 0xb4f2, 0xa678,
    0x3a50, 0x28da, 0x0919, 0x1b93, 0x5cc2, 0x4e48, 0x6f8b, 0x7d01,
    0x57da, 0x4550, 0x6493, 0x7619, 0x3148, 0x23c2, 0x0201, 0x108b,
    0x8ca3, 0x9e29, 0xbfea, 0xad60, 0xea31, 0xf8bb, 0xd978, 0xcbf2,
    0x9a93, 0x8819, 0xa9da, 0xbb50, 0xfc01, 0xee8b, 0xcf48, 0xddc2,
    0x41ea, 0x5360, 0x72a3, 0x6029, 0x2778, 0x35f2, 0x1431, 0x06bb,
    0x2c60, 0x3eea, 0x1f29, 0x0da3, 0x4af2, 0x5878, 0x79bb, 0x6b31,
    0xf719, 0xe593, 0xc450, 0xd6da, 0x918b, 0x8301, 0xa2c2, 0xb048,
    0xc253, 0xd0d9, 0xf11a, 0xe390, 0xa4c1, 0xb64b, 0x9788, 0x8502,
    0x192a, 0x0ba0, 0x2a63, 0x38e9, 0x7fb8, 0x6d32, 0x4cf1, 0x5e7b,
    0x74a0, 0x662a, 0x47e9, 0x5563, 0x1232, 0x00b8, 0x217b, 0x33f1,
    0xafd9, 0xbd53, 0x9c90, 0x8e1a, 0xc94b, 0xdbc1, 0xfa02, 0xe888,
    0xb9e9, 0xab63, 0x8aa0, 0x982a, 0xdf7b, 0xcdf1, 0xec32, 0xfeb8,
    0x6290, 0x701a, 0x51d9, 0x4353, 0x0402, 0x1688, 0x374b, 0x25c1,
    0x0f1a, 0x1d90, 0x3c53, 0x2ed9, 0x6988, 0x7b02, 0x5ac1, 0x484b,
    0xd463, 0xc6e9, 0xe72a, 0xf5a0, 0xb2f1, 0xa07b, 0x81b8, 0x9332,
    0x237a, 0x31f0, 0x1033, 0x02b9, 0x45e8, 0x5762, 0x76a1, 0x642b,
    0xf803, 0xea89, 0xcb4a, 0xd9c0, 0x9e91, 0x8c1b, 0xadd8, 0xbf52,
    0x9589, 0x8703, 0xa6c0, 0xb44a, 0xf31b, 0xe191, 0xc052, 0xd2d8,
    0x4ef0, 0x5c7a, 0x7db9, 0x6f33, 0x2862, 0x3ae8, 0x1b2b, 0x09a1,
    0x58c0, 0x4a4a, 0x6b89, 0x7903, 0x3e52, 0x2cd8, 0x0d1b, 0x1f91,
    0x83b9, 0x9133, 0xb0f0, 0xa27a, 0xe52b, 0xf7a1, 0xd662, 0xc4e8,
    0xee33, 0xfcb9, 0xdd7a, 0xcff0, 0x88a1, 0x9a2b, 0xbbe8, 0xa962,
    0x354a, 0x27c0, 0x0603, 0x1489, 0x53d8, 0x4152, 0x6091, 0x721b,
    0x0000, 0x6d82, 0xcd59, 0xa0db, 0x9ab3, 0xf731, 0x57ea, 0x3a68,
    0x233a, 0x4eb8, 0xee63, 0x83e1, 0xb989, 0xd40b, 0x74d0, 0x1952,
    0x4674, 0x2bf6, 0x8b2d, 0xe6af, 0xdcc7, 0xb145, 0x119e, 0x7c1c,
    0x654e, 0x08cc, 0xa817, 0xc595, 0xfffd, 0x927f, 0x32a4, 0x5f26,
    0x8ce8, 0xe16a, 0x41b1, 0x2c33, 0x165b, 0x7bd9, 0xdb02, 0xb680,
    0xafd2, 0xc250, 0x628b, 0x0f09, 0x3561, 0x58e3, 0xf838, 0x95ba,
    0xca9c, 0xa71e, 0x07c5, 0x6a47, 0x502f, 0x3dad, 0x9d76, 0xf0f4,
    0xe9a6, 0x8424, 0x24ff, 0x497d, 0x7315, 0x1e97, 0xbe4c, 0xd3ce,
    0x0f8c, 0x620e, 0xc2d5, 0xaf57, 0x953f, 0xf8bd, 0x5866, 0x35e4,
    0x2cb6, 0x4134, 0xe1ef, 0x8c6d, 0xb605, 0xdb87, 0x7b5c, 0x16de,
    0x49f8, 0x247a, 0x84a1, 0xe923, 0xd34b, 0xbec9, 0x1e12, 0x7390,
    0x6ac2, 0x0740, 0xa79b, 0xca19, 0xf071, 0x9df3, 0x3d28, 0x50aa,
    0x8364, 0xeee6, 0x4e3d, 0x23bf, 0x19d7, 0x7455, 0xd48e, 0xb90c,
    0xa05e, 0xcddc, 0x6d07, 0x0085, 0x3aed, 0x576f, 0xf7b4, 0x9a36,
    0xc510, 0xa892, 0x0849, 0x65cb, 0x5fa3, 0x3221, 0x92fa, 0xff78,
    0xe62a, 0x8ba8, 0x2b73, 0x46f1, 0x7c99, 0x111b, 0xb1c0, 0xdc42,
    0x0945, 0x64c7, 0xc41c, 0xa99e, 0x93f6, 0xfe74, 0x5eaf, 0x332d,
    0x2a7f, 0x47fd, 0xe726, 0x8aa4, 0xb0cc, 0xdd4e, 0x7d95, 0x1017,
    0x4f31, 0x22b3, 0x8268, 0xefea, 0xd582, 0xb800, 0x18db, 0x7559,
    0x6c0b, 0x0189, 0xa152, 0xccd0, 0xf6b8, 0x9b3a, 0x3be1, 0x5663,
    0x85ad, 0xe82f, 0x48f4, 0x2576, 0x1f1e, 0x729c, 0xd247, 0xbfc5,
    0xa697, 0xcb15, 0x6bce, 0x064c, 0x3c24, 0x51a6, 0xf17d, 0x9cff,
    0xc3d9, 0xae5b, 0x0e80, 0x6302, 0x596a, 0x34e8, 0x9433, 0xf9b1,
    0xe0e3, 0x8d61, 0x2dba, 0x4038, 0x7a50, 0x17d2, 0xb709, 0xda8b,
    0x06c9, 0x6b4b, 0xcb90, 0xa612, 0x9c7a, 0xf1f8, 0x5123, 0x3ca1,
    0x25f3, 0x4871, 0xe8aa, 0x8528, 0xbf40, 0xd2c2, 0x7219, 0x1f9b,
    0x40bd, 0x2d3f, 0x8de4, 0xe066, 0xda0e, 0xb78c, 0x1757, 0x7ad5,
    0x6387, 0x0e05, 0xaede, 0xc35c, 0xf934, 0x94b6, 0x346d, 0x59ef,
    0x8a21, 0xe7a3, 0x4778, 0x2afa, 0x1092, 0x7d10, 0xddcb, 0xb049,
    0xa91b, 0xc499, 0x6442, 0x09c0, 0x33a8, 0x5e2a, 0xfef1, 0x9373,
    0xcc55, 0xa1d7, 0x010c, 0x6c8e, 0x56e6, 0x3b64, 0x9bbf, 0xf63d,
    0xef6f, 0x82ed, 0x2236, 0x4fb4, 0x75dc, 0x185e, 0xb885, 0xd507,
    0x0000, 0x6d4e, 0xda9c, 0xb7d2, 0xa364, 0xce2a, 0x79f8, 0x14b6,
    0x46c9, 0x2b87, 0x9c55, 0xf11b, 0xe5ad, 0x88e3, 0x3f31, 0x527f,
    0x9bcf, 0xf681, 0x4153, 0x2c1d, 0x38ab, 0x55e5, 0xe237, 0x8f79,
    0xdd06, 0xb048, 0x079a, 0x6ad4, 0x7e62, 0x132c, 0xa4fe, 0xc9b0,
    0x21c2, 0x4c8c, 0xfb5e, 0x9610, 0x82a6, 0xefe8, 0x583a, 0x3574,
    0x670b, 0x0a45, 0xbd97, 0xd0d9, 0xc46f, 0xa921, 0x1ef3, 0x73bd,
    0xba0d, 0xd743, 0x6091, 0x0ddf, 0x1969, 0x7427, 0xc3f5, 0xaebb,
    0xfcc4, 0x918a, 0x2658, 0x4b16, 0x5fa0, 0x32ee, 0x853c, 0xe872,
    0x55d9, 0x3897, 0x8f45, 0xe20b, 0xf6bd, 0x9bf3, 0x2c21, 0x416f,
    0x1310, 0x7e5e, 0xc98c, 0xa4c2, 0xb074, 0xdd3a, 0x6ae8, 0x07a6,
    0xce16, 0xa358, 0x148a, 0x79c4, 0x6d72, 0x003c, 0xb7ee, 0xdaa0,
    0x88df, 0xe591, 0x5243, 0x3f0d, 0x2bbb, 0x46f5, 0xf127, 0x9c69,
    0x741b, 0x1955, 0xae87, 0xc3c9, 0xd77f, 0xba31, 0x0de3, 0x60ad,
    0x32d2, 0x5f9c, 0xe84e, 0x8500, 0x91b6, 0xfcf8, 0x4b2a, 0x2664,
    0xefd4, 0x829a, 0x3548, 0x5806, 0x4cb0, 0x21fe, 0x962c, 0xfb62,
    0xa91d, 0xc453, 0x7381, 0x1ecf, 0x0a79, 0x6737, 0xd0e5, 0xbdab,
    0xbdef, 0xd0a1, 0x6773, 0x0a3d, 0x1e8b, 0x73c5, 0xc417, 0xa959,
    0xfb26, 0x9668, 0x21ba, 0x4cf4, 0x5842, 0x350c, 0x82de, 0xef90,
    0x2620, 0x4b6e, 0xfcbc, 0x91f2, 0x8544, 0xe80a, 0x5fd8, 0x3296,
    0x60e9, 0x0da7, 0xba75, 0xd73b, 0xc38d, 0xaec3, 0x1911, 0x745f,
    0x9c2d, 0xf163, 0x46b1, 0x2bff, 0x3f49, 0x5207, 0xe5d5, 0x889b,
    0xdae4, 0xb7aa, 0x0078, 0x6d36, 0x7980, 0x14ce, 0xa31c, 0xce52,
    0x07e2, 0x6aac, 0xdd7e, 0xb030, 0xa486, 0xc9c8, 0x7e1a, 0x1354,
    0x412b, 0x2c65, 0x9bb7, 0xf6f9, 0xe24f, 0x8f01, 0x38d3, 0x559d,
    0xe836, 0x8578, 0x32aa, 0x5fe4, 0x4b52, 0x261c, 0x91ce, 0xfc80,
    0xaeff, 0xc3b1, 0x7463, 0x192d, 0x0d9b, 0x60d5, 0xd707, 0xba49,
    0x73f9, 0x1eb7, 0xa965, 0xc42b, 0xd09d, 0xbdd3, 0x0a01, 0x674f,
    0x3530, 0x587e, 0xefac, 0x82e2, 0x9654, 0xfb1a, 0x4cc8, 0x2186,
    0xc9f4, 0xa4ba, 0x1368, 0x7e26, 0x6a90, 0x07de, 0xb00c, 0xdd42,
    0x8f3d, 0xe273, 0x55a1, 0x38ef, 0x2c59, 0x4117, 0xf6c5, 0x9b8b,
    0x523b, 0x3f75, 0x88a7, 0xe5e9, 0xf15f, 0x9c11, 0x2bc3, 0x468d,
    0x14f2, 0x79bc, 0xce6e, 0xa320, 0xb796, 0xdad8, 0x6d0a, 0x0044
#endif
};

inline uint16_t crc16Next(uint16_t crc, uint8_t data)
{
#ifdef BMCL_LITTLE_ENDIAN
    return (crc >> 8) ^ crcTable[(crc & 0xff) ^ data];
#else
    return (crc << 8) ^ crc_table[((crc >> 8) & 0xff) ^ data];
#endif
}

static inline uint16_t crcNext4(uint16_t crc, uint32_t data)
{
#ifdef BMCL_LITTLE_ENDIAN
    crc ^= data & 0xffff;
    crc = crcTable[(crc & 0xff) + 0x300] ^
          crcTable[((crc >> 8) & 0xff) + 0x200] ^
          crcTable[((data >> 16) & 0xff) + 0x100] ^
          crcTable[data >> 24];
#else
    crc ^= data >> 16;
    crc = crc_table[data & 0xff] ^
          crc_table[((data >> 8) & 0xff) + 0x100] ^
          crc_table[(crc & 0xff) + 0x200] ^
          crc_table[((crc >> 8) & 0xff) + 0x300];
#endif
        return crc;
}

static inline uint16_t crcFinal(uint16_t crc)
{
#ifndef BMCL_LITTLE_ENDIAN
    crc = (crc >> 8) | ((crc & 0xff) << 8);
#endif
    return crc;
}

void Crc16::update(const void* src, std::size_t len)
{
    const uint8_t* data = (const uint8_t*)src;
    uint16_t crc = _crc;

    while (((uintptr_t)data & 3) && len) {
            crc = crc16Next(crc, *data++);
            len--;
    }

    while (len >= 16) {
            len -= 16;
            crc = crcNext4(crc, ((uint32_t *)data)[0]);
            crc = crcNext4(crc, ((uint32_t *)data)[1]);
            crc = crcNext4(crc, ((uint32_t *)data)[2]);
            crc = crcNext4(crc, ((uint32_t *)data)[3]);
            data += 16;
    }

    while (len--) {
            crc = crc16Next(crc, *data++);
    }

    _crc = crc;
}

uint16_t Crc16::get() const
{
    return crcFinal(_crc);
}

void Crc16::update(uint8_t byte)
{
    _crc = crc16Next(_crc, byte);
}

void Crc16::update(bmcl::Bytes data)
{
    update(data.data(), data.size());
}
}
